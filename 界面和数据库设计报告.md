# 界面和数据库设计报告

## 4.2 界面设计

### 4.2.1 整体布局设计

系统采用现代化的响应式布局设计，基于Next.js 14和Tailwind CSS实现，整体结构包括：

- **顶部导航栏**：显示系统标题、用户信息和登录/登出按钮
- **侧边栏**：提供主要功能导航，包括仪表盘、交易记录、分类管理、预算管理、数据导入/导出等
- **主内容区**：根据选择的功能显示相应的内容，采用卡片式布局，确保信息层次清晰

布局组件实现代码：
```tsx
// components/layout/Layout.tsx
export default function Layout({ children }: LayoutProps) {
  return (
    <div className="min-h-screen bg-gray-50">
      <Navbar />
      <div className="flex">
        <Sidebar />
        <main className="flex-1 p-6">{children}</main>
      </div>
    </div>
  );
}
```

### 4.2.2 核心页面设计

#### 仪表盘页面

仪表盘是系统的核心页面，提供用户财务状况的概览，包括：

1. **数据卡片**：显示总收入、总支出、余额和本月预算
2. **日期范围选择**：支持预设范围（7天、30天、90天、半年、一年）和自定义日期范围
3. **预算预警**：根据预算使用情况显示不同状态的预警（安全、警告、危险）
4. **数据可视化**：
   - 收支趋势折线图
   - 支出分类占比饼图
   - 月度收支统计柱状图
5. **最近交易记录**：显示最近的交易详情

关键设计特点：
- 使用动画效果提升用户体验（加载状态、卡片悬停效果）
- 响应式设计，适配不同屏幕尺寸
- 收入使用红色，支出使用绿色，符合用户习惯
- 详细的预算使用百分比和进度条显示

#### 交易管理页面

提供交易记录的增删改查功能，支持批量操作和筛选。

#### 分类管理页面

允许用户创建、编辑和删除交易分类，设置分类图标和颜色。

#### 预算管理页面

支持用户为不同分类设置预算，监控预算使用情况。

#### 数据导入/导出页面

- **导入**：支持微信账单和系统自身导出的CSV文件导入
- **导出**：支持将交易数据导出为CSV格式

### 4.2.3 交互流程设计

1. **用户登录流程**：
   - 用户输入邮箱和密码
   - 系统验证身份
   - 登录成功后跳转到仪表盘

2. **交易添加流程**：
   - 用户点击"添加交易"
   - 填写交易详情（金额、类型、分类、描述、日期）
   - 提交表单
   - 系统保存交易并更新相关统计数据

3. **一键分类流程**：
   - 用户在交易列表页面点击"一键分类"
   - 系统根据预设规则自动分类未分类交易
   - 显示分类结果和创建的新分类

4. **数据导入流程**：
   - 用户选择文件类型（微信账单或系统CSV）
   - 上传文件
   - 系统解析文件内容
   - 显示解析结果和预览
   - 用户确认后导入数据

### 4.2.4 助手在UI代码生成中的作用

在UI代码生成过程中，助手起到了以下作用：

1. **组件化设计**：
   - 生成可复用的UI组件（Button、Input、Select等）
   - 创建布局组件（Layout、Navbar、Sidebar）
   - 实现图表组件（BarChart、LineChart、PieChart）

2. **交互逻辑实现**：
   - 实现日期范围选择和预设功能
   - 添加预算预警逻辑和视觉效果
   - 实现加载状态和错误处理
   - 添加卡片悬停效果和过渡动画

3. **响应式设计**：
   - 使用Tailwind CSS的响应式类实现不同屏幕尺寸的适配
   - 优化移动端和桌面端的布局差异

4. **数据可视化**：
   - 配置Recharts图表组件，实现数据的直观展示
   - 优化图表配色和交互体验

5. **用户体验优化**：
   - 添加适当的空状态提示
   - 实现平滑的页面过渡效果
   - 优化表单验证和错误提示

## 4.3 数据库设计

### 4.3.1 数据模型设计

系统使用SQLite作为数据库，Prisma作为ORM工具，设计了以下数据模型：

#### 用户模型（User）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | String | @id @default(cuid()) | 用户唯一标识 |
| email | String | @unique | 用户邮箱 |
| password | String | - | 加密后的密码 |
| name | String | ? | 用户名 |
| createdAt | DateTime | @default(now()) | 创建时间 |
| updatedAt | DateTime | @updatedAt | 更新时间 |

#### 分类模型（Category）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | String | @id @default(cuid()) | 分类唯一标识 |
| userId | String | @relation(fields: [userId], references: [id]) | 所属用户ID |
| name | String | - | 分类名称 |
| type | String | - | 分类类型（income/expense/neutral） |
| icon | String | ? | 分类图标 |
| color | String | ? | 分类颜色 |
| createdAt | DateTime | @default(now()) | 创建时间 |
| updatedAt | DateTime | @updatedAt | 更新时间 |

#### 交易模型（Transaction）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | String | @id @default(cuid()) | 交易唯一标识 |
| userId | String | @relation(fields: [userId], references: [id]) | 所属用户ID |
| type | String | - | 交易类型（income/expense） |
| amount | Float | - | 交易金额 |
| categoryId | String | ? @relation(fields: [categoryId], references: [id]) | 分类ID |
| description | String | ? | 交易描述 |
| date | DateTime | @default(now()) | 交易日期 |
| createdAt | DateTime | @default(now()) | 创建时间 |
| updatedAt | DateTime | @updatedAt | 更新时间 |

### 4.3.2 关系设计

1. **User 与 Transaction**：一对多关系，一个用户可以有多个交易记录
2. **User 与 Category**：一对多关系，一个用户可以有多个分类
3. **Category 与 Transaction**：一对多关系，一个分类可以对应多个交易记录

### 4.3.3 索引设计

为提高查询性能，设计了以下索引：

- **User模型**：
  - email字段（唯一索引，用于快速查找用户）

- **Category模型**：
  - userId字段（普通索引，用于快速查找用户的分类）
  - (userId, type, name)组合（唯一索引，确保用户的分类名称在同一类型下唯一）

- **Transaction模型**：
  - userId字段（普通索引，用于快速查找用户的交易记录）
  - date字段（普通索引，用于按日期范围查询交易记录）

### 4.3.4 助手生成SQL语句的场景

在数据库设计和操作过程中，助手生成SQL语句的场景包括：

1. **数据库迁移**：
   - 生成初始数据库结构的SQL语句
   - 处理数据模型变更的迁移SQL语句

2. **数据查询**：
   - 生成统计数据查询SQL（如总收入、总支出、余额等）
   - 生成按日期范围、分类等条件的查询SQL
   - 生成关联查询SQL（如交易与分类的关联）

3. **数据操作**：
   - 生成交易添加、更新、删除的SQL语句
   - 生成分类管理相关的SQL语句
   - 生成用户认证相关的SQL语句

4. **性能优化**：
   - 生成索引创建的SQL语句
   - 优化复杂查询的SQL语句

### 4.3.5 数据库配置

系统使用SQLite作为数据库，配置如下：

```prisma
generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}
```

通过环境变量配置数据库连接，支持不同环境的部署需求。

### 4.3.6 数据安全考虑

1. **密码加密**：用户密码使用bcrypt算法加密存储
2. **数据隔离**：通过userId字段确保用户只能访问自己的数据
3. **输入验证**：实现严格的输入验证，防止SQL注入攻击
4. **事务处理**：在关键操作中使用事务，确保数据一致性

## 总结

本系统的界面设计采用现代化的响应式布局，结合Tailwind CSS实现了美观、直观的用户界面，同时通过Recharts库提供了丰富的数据可视化功能。数据库设计基于SQLite和Prisma ORM，采用简洁明了的数据模型，确保了数据的高效存储和查询。

助手在UI代码生成和数据库设计过程中发挥了重要作用，帮助实现了组件化设计、交互逻辑、响应式布局、数据可视化以及数据库结构设计和SQL语句生成等关键功能，大大提高了开发效率和代码质量。